"use strict";function n(n){return!(!n||"string"!=typeof n.value)}function t(n){return!(!n||3!==n.nodeType)}function e(n){return null==n&&(n=function(n){return null===Object.getPrototypeOf(n)}),function(t){for(;null!==t;)if(t=Object.getPrototypeOf(t),!0===n(t))return t;return null}}var r=function(n){var t=function(t){return Object.getOwnPropertyDescriptor(t,n)},r=e(function(n){return void 0!==t(n)});return function(n,e){var o=r(n);null!=o&&t(o).set.call(n,e)}},o=r("value"),u=r("nodeValue"),i=r("textContent");function f(e,r){if(null!=e&&null!=r)return n(e)?o(e,r):t(e)?u(e,r):i(e,r)}function l(e){return null==e?"":n(e)?e.value:t(e)?e.nodeValue:e.textContent||""}var a=d(c("nextSibling")),s=d(c("previousSibling"));function c(n){return function(t){if(!t)return null;if(t.hasChildNodes())return t.firstChild;for(;t&&!t[n];)t=t.parentNode;return null!==t&&(t=t[n]),t}}function d(n){return function(t,e){if(t=n(t),"number"==typeof e)for(;t&&t.nodeType!==e;)t=n(t);return t}}function g(n){if(null==n)return[];var e=[],r=n.startContainer,o=n.endContainer;if(e.push(r),r===o)return e;for(;r&&r!==o;)t(r=a(r))&&e.push(r);return e}function v(n,t,e,r){var o=null==n?-1:n.length;if(o<0)return"";if(void 0===r&&"function"==typeof e&&(r=e,e=o),t=null==t?0:t,e=void 0===e?o:e,t<0&&(t=-t>o?0:o+t),(e=e>o?o:e)<0&&(e+=o),t>e&&t<o&&(e=[t,t=e][0]),t>o)return n;"function"==typeof r&&(r=r(o?n.substring(t,e):""));return n.substring(0,t)+(null!=r?r:"")+n.substring(e)}var h={get text(){return l(this.node)},get selectedText(){return this.text.substring(this.startOffset,this.endOffset)},set selectedText(n){n=String(n),f(this.node,v(this.text,this.startOffset,this.endOffset,n)),this.endOffset=this.startOffset+n.length}};function p(n){if(null==n)return null;var t=n.node,e=n.startOffset,r=n.endOffset,o=Object.create(h);return o.node=t,o.startOffset=e,o.endOffset=r,o}function O(n){return g(n).map(function(t,e,r){var o=n.startOffset,u=n.endOffset;return e>0&&(o=0),e<r.length-1&&(u=l(t).length),p({node:t,startOffset:o,endOffset:u})})}function m(n){return n.defaultView||n.parentWindow}function C(n){return n.contentWindow||n.contentDocument.defaultView}function y(n){return n.contentDocument||n.contentWindow.document}function x(n){return n&&n.tagName&&n.tagName.toLowerCase()||""}function b(n,t){var e,r,o=n.duplicate(),u=n.duplicate(),i=void 0,f=-1;for(o.collapse(!!t),e=o.parentElement(),u.moveToElementText(e),u.setEndPoint("EndToStart",o),i=u.text.replace(/\r\n/gm,"\n").length;i>-1&&f+1<e.childNodes.length;)i-=(e.childNodes[++f].nodeValue||e.childNodes[f].innerHTML).length;return{node:r=e.childNodes[f]||e,offset:String(r.nodeValue||r.innerHTML||r.value||"").length+i}}function E(n,t){if(n===t)return n;var e=n.parentElement||n.parentNode;if(e.contains(t))return e;var r=t.parentElement||t.parentNode;return r.contains(n)?r:E(e,r)}function N(n){return null!=n&&(void 0===n.isContentEditable&&(n=n.parentElement||n.parentNode),n.isContentEditable)}function S(t){return N(t)||n(t)}function V(n){if(null==n)return null;var t=n.collapsed,e=n.commonAncestorContainer,r=n.startContainer,o=n.startOffset,u=n.endContainer,i=n.endOffset;return void 0===t&&(t=r===u&&o===i),void 0===e&&(e=E(r,u)),{editable:S(e),collapsed:t,commonAncestorContainer:e,startContainer:r,startOffset:o,endContainer:u,endOffset:i}}function w(n,t){if(void 0!==n.getSelection){var e=n.getSelection();if(e.rangeCount>0)return V(e.getRangeAt(0))}if(void 0!==t.selection){var r=t.selection.createRange(),o=b(r,!0),u=b(r,!1);return V({commonAncestorContainer:o.node===u.node?o.node:r.parentElement(),startContainer:o.node,startOffset:o.offset,endContainer:u.node,endOffset:u.offset})}return null}function T(n){var e=n.startContainer,r=n.startOffset,o=n.endContainer,u=n.endOffset;return t(e)||(e=a(e,3),r=0),t(o)||(u=(o=s(o,3)||e).nodeValue.length),V({startContainer:e,startOffset:r,endContainer:o,endOffset:u})}function A(n,t){var e=t.activeElement;if(null==e)return null;var r=x(e);if("textarea"===r||"input"===r)try{return V({startContainer:e,startOffset:e.selectionStart,endContainer:e,endOffset:e.selectionEnd})}catch(n){return null}if("iframe"===r||"frame"===r)try{return A(C(e),y(e))}catch(n){return null}var o=w(n,t);return null===o?null:(!1===o.collapsed&&(o=T(o)),o)}function R(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return A(m(n),n)}function j(n){return n.ownerDocument||document}function D(n){return m(j(n))}function P(n){if("function"!=typeof n)throw"getChildBy requires `predicate` as a Function";return function(t){if(null!=t)for(var e=t.childNodes,r=0;r<e.length;r++)if(!0===n(e[r]))return e[r];return null}}function L(n){return!(!n||"string"!=typeof n.nodeValue)}function W(n){return!(!n||!n.commonAncestorContainer)}var H=function(n,t){return n<t?n:t},M=P(function(n){return n.textContent&&""!==n.textContent.trim()}),q=function(n){return n&&(L(n)?n:M(n))};function B(n,t,e,r){if(null!=n){null==t&&(t=n),e=H(e,n.nodeValue.length),r=H(r,t.nodeValue.length);var o=D(n).getSelection(),u=j(n).createRange();u.setStart(n,e),u.setEnd(t,r),o.removeAllRanges(),o.addRange(u)}}function F(n,t,e){var r=n.value.length;n.setSelectionRange(H(t,r),H(e,r))}function k(n,t,e){var r=null;if(Array.isArray(n)&&(r=n[n.length-1],n=n[0]),null!=n){(null==t||t<0)&&(t=0),(null==e||e<t)&&(e=t),W(n)&&(t=n.startOffset,e=n.endOffset,r=n.endContainer,n=n.startContainer);var o=x(n);return"textarea"===o||"input"===o?F(n,t,e):B(q(n),q(r),t,e)}}var z={rangeContent:O,selectionRange:R,setSelection:k};module.exports=z;
